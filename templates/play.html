<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>NBA Salaries</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header"><!--
        <a class="navbar-brand" href="index.html">
          <img class = "logo" src = "logo.png">
        </a> -->
        <a class = "navbar-brand" href="index.html"><h1>Getting Paid in the NBA</h1></a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Machine Learning<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="sal.html">Salary</a></li>
              <li><a href="play.html">Play</a></li>
            </ul>
          </li>
          <li><a href="viz.html" class = "nav-link">Viz</a></li>
          <li><a href="data.html" class = "nav-link">Data</a></li>
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>

  <!-- Intro text -->
  <div class = "container">
      <div class = "row">
        <div class = "col-md-6 col-lg-12">
            <h3><b>Not all drafted players get to play.</b></h3>
            <p>This model used players' draft data to predict whether or not they actually ended up playing in their first NBA season, or whether they had to sit sadly on the sidelines.</p>
            <p><b>Steps:</b></p>
            <ol>
                <li><a href = "#feat-sel">Feature Selection</a></li>
                <li><a href = "#cv">Cross-Validation</a></li>
                <li><a href = "#test-new">Testing the Classifier</a></li>
            </ol>
        </div>
      </div>


<!-- Feature selection -->


      <div class = "row">
        <div class = "col-md-6 col-lg-12">
            <a id = "feat-sel"><h3><b>1. Feature Selection</b></h3></a>
            <p>We used <b>stratified k-fold cross-validation</b> to pick features by getting correlations between <code>Roster</code>, which represents whether a drafted player actually played in their first NBA season, and each draft variable:</p>
            <ul>
                <li><code>draft_All_NBA</code>: Number of All-NBA games</li>
                <li><code>draft_All.Star</code>: Number of All-Star games</li>
                <li><code>draft_Pk</code>: Draft pick order</li>
                <li><code>draft_Games</code>: Number of games</li>
                <li><code>draft_Minutes.Played</code>: Minutes played</li>
                <li><code>draft_Minutes.per.Game</code>: Minutes played per game</li>
                <li><code>draft_Points.per.Game</code>: Points played per game</li>
                <li><code>draft_Win.Share</code>: Win-share</li>
                <li><code>draft_VORP</code>: Value over replacement</li>
                <li><code>draft_WS_per_game</code>: Win-share per game</li>
                <li><code>draft_attend_college</code>: Drafted from college</li>
            </ul>
        </div>
      </div>
      <button data-toggle = "collapse" data-target = "#k-fold-corr">Code</button>
          <div id = "k-fold-corr" class = "collapse"><br>

    <!-- All features object -->
                <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># All features</span>
                <span class="n">all_feat</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;draft_All_NBA&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_All.Star&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_Pk&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_Games&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_Minutes.Played&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_Minutes.per.Game&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_Points.per.Game&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_Win.Share&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_VORP&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_WS_per_game&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;draft_attend_college&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Roster&quot;</span><span class="p">]</span>
                </pre></div>

    <!-- Select all-features from data -->

                <div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">orig_data</span><span class="p">[</span><span class="n">all_feat</span><span class="p">]</span>
                </pre></div>

    <!-- Correlations -->
                <div class=" highlight hl-ipython3"><pre><span></span><span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Roster&quot;</span><span class="p">],</span> <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">fold_count</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">corrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

                <span class="c1"># Correlations with &quot;Roster&quot;</span>

                <span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">skf</span><span class="p">:</span>

                    <span class="c1"># Log</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&gt;&gt;&gt; Running fold </span><span class="si">{fold_count}</span><span class="s2"> &lt;&lt;&lt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># Training &amp; testing dfs</span>
                    <span class="n">train_fold</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train</span><span class="p">]</span>
                    <span class="n">test_fold</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test</span><span class="p">]</span>

                    <span class="c1"># Best features</span>
                    <span class="n">corr</span> <span class="o">=</span> <span class="n">train_fold</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s2">&quot;Roster&quot;</span><span class="p">][</span><span class="n">train_fold</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s2">&quot;Roster&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
                    <span class="n">corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Roster&quot;</span><span class="p">:</span> <span class="n">f</span><span class="s2">&quot;Fold </span><span class="si">{fold_count}</span><span class="s2">&quot;</span><span class="p">})</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

                    <span class="c1"># Increment fold</span>
                    <span class="n">fold_count</span> <span class="o">+=</span> <span class="mi">1</span>
                </pre></div></div>

<!-- Correlations table -->

      <button data-toggle = "collapse" data-target = "#all-corr">K-fold correlations</button>
        <div class = "collapse" id = "all-corr"><br>
                <table class="table table-hover">
          <thead>
            <tr style="text-align: right;">
              <th></th>
              <th>draft_All.Star</th>
              <th>draft_All_NBA</th>
              <th>draft_Games</th>
              <th>draft_Minutes.Played</th>
              <th>draft_Minutes.per.Game</th>
              <th>draft_Pk</th>
              <th>draft_Points.per.Game</th>
              <th>draft_VORP</th>
              <th>draft_WS_per_game</th>
              <th>draft_Win.Share</th>
              <th>draft_attend_college</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>Fold 1</th>
              <td>0.092333</td>
              <td>0.081221</td>
              <td>0.425231</td>
              <td>0.359540</td>
              <td>0.535775</td>
              <td>-0.476737</td>
              <td>0.451963</td>
              <td>0.154236</td>
              <td>0.214060</td>
              <td>0.258547</td>
              <td>0.394295</td>
            </tr>
            <tr>
              <th>Fold 2</th>
              <td>0.087764</td>
              <td>0.075172</td>
              <td>0.423274</td>
              <td>0.356813</td>
              <td>0.536525</td>
              <td>-0.472424</td>
              <td>0.453936</td>
              <td>0.154821</td>
              <td>0.222859</td>
              <td>0.262194</td>
              <td>0.392000</td>
            </tr>
            <tr>
              <th>Fold 3</th>
              <td>0.090852</td>
              <td>0.079252</td>
              <td>0.412525</td>
              <td>0.343076</td>
              <td>0.521336</td>
              <td>-0.473138</td>
              <td>0.437825</td>
              <td>0.154413</td>
              <td>0.206054</td>
              <td>0.255142</td>
              <td>0.394334</td>
            </tr>
            <tr>
              <th>Fold 4</th>
              <td>0.093020</td>
              <td>0.080739</td>
              <td>0.411227</td>
              <td>0.346426</td>
              <td>0.523727</td>
              <td>-0.475965</td>
              <td>0.439891</td>
              <td>0.155018</td>
              <td>0.208127</td>
              <td>0.257448</td>
              <td>0.376509</td>
            </tr>
            <tr>
              <th>Fold 5</th>
              <td>0.090485</td>
              <td>0.083803</td>
              <td>0.410928</td>
              <td>0.349561</td>
              <td>0.531973</td>
              <td>-0.480477</td>
              <td>0.447342</td>
              <td>0.158346</td>
              <td>0.208149</td>
              <td>0.260038</td>
              <td>0.355815</td>
            </tr>
            <tr>
              <th>Fold 6</th>
              <td>0.090935</td>
              <td>0.078666</td>
              <td>0.412884</td>
              <td>0.348459</td>
              <td>0.540216</td>
              <td>-0.481536</td>
              <td>0.452624</td>
              <td>0.154057</td>
              <td>0.212840</td>
              <td>0.256029</td>
              <td>0.364547</td>
            </tr>
            <tr>
              <th>Fold 7</th>
              <td>0.104137</td>
              <td>0.091895</td>
              <td>0.406784</td>
              <td>0.345066</td>
              <td>0.530192</td>
              <td>-0.484338</td>
              <td>0.446856</td>
              <td>0.155775</td>
              <td>0.216417</td>
              <td>0.256753</td>
              <td>0.383185</td>
            </tr>
            <tr>
              <th>Fold 8</th>
              <td>0.093933</td>
              <td>0.081421</td>
              <td>0.422848</td>
              <td>0.356401</td>
              <td>0.537646</td>
              <td>-0.491569</td>
              <td>0.452797</td>
              <td>0.155129</td>
              <td>0.211037</td>
              <td>0.261862</td>
              <td>0.345254</td>
            </tr>
            <tr>
              <th>Fold 9</th>
              <td>0.094896</td>
              <td>0.082639</td>
              <td>0.424135</td>
              <td>0.359760</td>
              <td>0.538593</td>
              <td>-0.475576</td>
              <td>0.449768</td>
              <td>0.160469</td>
              <td>0.230046</td>
              <td>0.264547</td>
              <td>0.364104</td>
            </tr>
            <tr>
              <th>Fold 10</th>
              <td>0.098792</td>
              <td>0.086542</td>
              <td>0.435905</td>
              <td>0.366800</td>
              <td>0.526627</td>
              <td>-0.482906</td>
              <td>0.444397</td>
              <td>0.164172</td>
              <td>0.229397</td>
              <td>0.272318</td>
              <td>0.371106</td>
            </tr>
          </tbody>
          </table>
          </div><br>
        </div>

<!-- Correlation explanation -->
    <div class = "container">
        <br>
        <p>We averaged the correlations produced from each of the k = 10 folds and selected only <b>correlations above .3</b>.</p>

      <button data-toggle = "collapse" data-target = "#avg-corr-code">Code</button>
        <div class = "collapse" id = "avg-corr-code"><br>
            <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Average correlations</span>
            <span class="n">avg_corrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">corrs</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">avg_corrs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Avg corr&quot;</span><span class="p">]</span>
            <span class="n">avg_corrs</span><span class="p">[</span><span class="s2">&quot;Avg corr (Abs)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_corrs</span><span class="p">[</span><span class="s2">&quot;Avg corr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
            <span class="n">avg_corrs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;Avg corr (Abs)&quot;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            </pre></div>

<!-- Select features > .3 -->
            <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Top features - greater than .3 corr w Roster</span>
            <span class="n">sel_feat</span> <span class="o">=</span> <span class="n">avg_corrs</span><span class="p">[</span><span class="n">avg_corrs</span><span class="p">[</span><span class="s2">&quot;Avg corr (Abs)&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">sel_feat</span>
            </pre></div>
        </div>

      <button data-toggle = "collapse" data-target = "#avg-corr">Avg. correlations</button><br>
        <div class = "collapse col-lg-6" id = "avg-corr">
            <table class="table table-hover">
              <thead>
                <tr style="text-align: right;">
                  <th></th>
                  <th>Avg corr</th>
                  <th>Avg corr (Abs)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>draft_Minutes.per.Game</th>
                  <td>0.532261</td>
                  <td>0.532261</td>
                </tr>
                <tr>
                  <th>draft_Pk</th>
                  <td>-0.479467</td>
                  <td>0.479467</td>
                </tr>
                <tr>
                  <th>draft_Points.per.Game</th>
                  <td>0.447740</td>
                  <td>0.447740</td>
                </tr>
                <tr>
                  <th>draft_Games</th>
                  <td>0.418574</td>
                  <td>0.418574</td>
                </tr>
                <tr>
                  <th>draft_attend_college</th>
                  <td>0.374115</td>
                  <td>0.374115</td>
                </tr>
                <tr>
                  <th>draft_Minutes.Played</th>
                  <td>0.353190</td>
                  <td>0.353190</td>
                </tr>
                <tr class = "ns">
                  <th>draft_Win.Share</th>
                  <td>0.260488</td>
                  <td>0.260488</td>
                </tr>
                <tr class = "ns">
                  <th>draft_WS_per_game</th>
                  <td>0.215899</td>
                  <td>0.215899</td>
                </tr>
                <tr class = "ns">
                  <th>draft_VORP</th>
                  <td>0.156643</td>
                  <td>0.156643</td>
                </tr>
                <tr class = "ns">
                  <th>draft_All.Star</th>
                  <td>0.093715</td>
                  <td>0.093715</td>
                </tr>
                <tr class = "ns">
                  <th>draft_All_NBA</th>
                  <td>0.082135</td>
                  <td>0.082135</td>
                </tr>
              </tbody>
            </table>
            <b>&ensp;Note.</b> <i>Avg corr (Abs)</i> refers to the absolute value of the correlation. Correlations in gray were below .3.
        </div><br>
<!-- Final features -->
        <p>The <b>final features</b> were:</p>
        <ul>
            <li><code>draft_Games</code>: Number of games</li>
            <li><code>draft_Minutes.Played</code>: Minutes played</li>
            <li><code>draft_Minutes.per.Game</code>: Minutes played per </li>
            <li><code>draft_Pk</code>: Draft pick order</li>
            <li><code>draft_Points.per.Game</code>: Points played per game</li>
            <li><code>draft_attend_college</code>: Drafted from college</li>
        </ul>
    </div>
  </div>



<!-- Cross-validation -->


  <div class = "container">
      <div class = "row">
        <div class = "col-md-6 col-lg-12">
            <a id = "cv"><h3><b>2. Cross-Validation</b></h3></a>
            <p>We <b>evaluated the classifier</b> by getting predictions on the entire 2000-2015 draft dataset with cross-validation. The classifier performed well but was <b>more effective in classifying players who played</b>, possibly because of the larger sample size.
        </div>
      </div>

      <button data-toggle = "collapse" data-target = "#cv-code">Code</button>
          <div class = "collapse" id = "cv-code"><br>

            <div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">sel_feat</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Roster&quot;</span><span class="p">]</span>
            </pre></div>

            <div class=" highlight hl-ipython3"><pre><span></span><span class="n">predicted</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">acc_score</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">predicted</span><span class="p">)</span>
            <span class="n">roster_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Did not play&quot;</span><span class="p">,</span> <span class="s2">&quot;Played&quot;</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Accuracy score: {round(acc_score, 2)}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Classification report&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">predicted</span><span class="p">,</span> <span class="n">target_names</span> <span class="o">=</span> <span class="n">roster_vars</span><span class="p">))</span>
            </pre></div>

          </div>

    <br><br><p><b>Accuracy score: 0.87</b></p>
    <p><b>Classification report:</b></p>
    <div class = "col-md-6">
        <table class="table table-hover">
                  <thead>
                    <tr style="text-align: right;">
                      <th></th>
                      <th title = "Of players classifed, how many were classified correctly">Precision</th>
                      <th title = "Of players actually in each group, how many classified correctly">Recall</th>
                      <th title = "2 * precision * recall/(precision + recall)">F1 Score</th>
                      <th>Support</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th>Did not play</th>
                      <td>0.79</td>
                      <td>0.71</td>
                      <td>0.75</td>
                      <td>234</td>
                    </tr>
                    <tr>
                      <th>Played</th>
                      <td>0.90</td>
                      <td>0.93</td>
                      <td>0.92</td>
                      <td>655</td>
                    </tr>
                    <tr>
                      <th>Average/Total</th>
                      <td>0.87</td>
                      <td>0.87</td>
                      <td>0.87</td>
                      <td>889</td>
                    </tr>
                  </tbody>
                </table>
        </div>
    </div>

<!-- Testing on new data -->
  <div class = "container">
      <div class = "row">
        <div class = "col-md-6 col-lg-12">
            <a id = "test-new"><h3><b>3. Testing on New Data</b></h3></a>
            <p>We <b>evaluated the classifier</b> by getting predictions on the entire 2000-2015 draft dataset with cross-validation. The classifier performed well but was <b>more effective in classifying players who played</b>, possibly because of the larger sample size.
        </div>
      </div>

  </div>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

</html>
